---
title: "Os 7 hábitos dos desenvolvedores de WebServices altamente eficazes"
date: "2008-02-18"
author: "peas"
authorEmail: "paulo.silveira@caelum.com.br"
main_guide: "main_guide"
main_category: "geral"
---

Esta semana tive o prazer de palestrar no [Café Com Tapioca](http://www.cejug.org/display/cejug/2008/02/03/Recheio+da+Tapioca+de+Coco), evento do [CeJUG](http://www.cejug.org/) realizado em Fortaleza. Estavam presentes dois conhecidos evangelistas da Sun: Reggie Hutcherson e [Simon Ritter](http://blogs.sun.com/simonri/).

[![DSC01766](http://farm3.static.flickr.com/2045/2261620995_19718597e1_m.jpg)](http://www.flickr.com/photos/silveira/2261620995/ "DSC01766 by Paulo Silveira, on Flickr") [![DSC01773](http://farm3.static.flickr.com/2018/2261621995_814a044b52_m.jpg)](http://www.flickr.com/photos/silveira/2261621995/ "DSC01773 by Paulo Silveira, on Flickr") [![DSC01770](http://farm3.static.flickr.com/2403/2261621465_02e8082782_m.jpg)](http://www.flickr.com/photos/silveira/2261621465/ "DSC01770 by Paulo Silveira, on Flickr") [![DSC01763](http://farm3.static.flickr.com/2403/2261620513_67bbd9b9b6_m.jpg)](http://www.flickr.com/photos/silveira/2261620513/ "DSC01763 by Paulo Silveira, on Flickr")

O agradecimento fica ao [Rafael Carneiro](http://www.rafaelcarneiro.org/blog/), do PortalJava e do CeJUG, pela organização geral do evento. Agradeço também à equipe do grupo Fortes pela minha vinda ao Ceará: ao Clavius Tales, [Igo Coelho](http://www.igocoelho.com.br/), Antônio Israel, [Ronaldo Moreira](http://blog.ronaldomoreira.com/), [Tiago Moraes](http://tiagomoraes.blogspot.com/), [Rodrigo Maia](http://thinkabouttests.blogspot.com/) e tantos outros. Vale reparar como a comunidade java cearense é ativa nos blogs! Nesse sábado também ministrei um[workshop sobre Arquitetura e Design Java](http://www.cejug.org/pages/viewpage.action?pageId=17530896) aqui em Fortaleza.

Durante esses dias aqui, muitas pessoas perguntaram bastante sobre webservices: em especial JSON e Rest. Compilei alguns dos pontos que foram recorrentes nas discussões e considerados como boas práticas:

**Cuidado com a granularidade** - a granularidade do seu serviço não pode ser muito fina, caso contrário seus seviços sofrerão dos mesmos problemas que o EntityBean do EJB2 exposto remotamente: uma enorme quantidade de requisições serão disparadas para executar pequenas tarefas, como getters! Seus serviços devem realizar uma quantidade significativa de tarefas, para evitar um número alto de roundtrips!

**Exponha serviços, não dados** - é comum ouvir a frase "_Vou criar webservices para expor os meus dados_". O grande perigo aqui é deixar toda a lógica de negócio na mão do cliente, o que descentralizará seu serviço e forçará o cliente a realizar muitas requisições ao servidor. Devemos expor serviços, e não dados em sua forma mais crua.

**Nunca parsear WSDL/SOAP manualmente** - antes das ferramentas que trabalham com webservices terem atingido sua maturidade, era muito comum ver por aí as pessoas gerando o SOAP manualmente, através de bibliotecas XML ou às vezes até mesmo concatenando `String` com o uso de `StringBuffer`! O SOAP é o protocolo de comunicação, e assim como quando você usa RMI/CORBA e você não enxerga absolutamente nada do JRMP/IIOP, você nunca deveria ter contato direto com o protocolo de comunicação! O SOAP e o WSDL devem ser utilizados por ferramentas, e não pela sua própria aplicação. Hoje em dia qualquer ferramenta como o Apache Axis, Apache CXF, ou mesmo o [wsimport](https://blog.caelum.com.br/2007/07/11/webservices-sem-servidor-de-aplicacao-no-java-6/), que já vem no JDK 6, auxilia nossa tarefa de gerar Stubs que sabem trabalhar com o SOAP, sem que você nem mesmo precise ve-lo um dia. Se você está usando um servidor de aplicação, [esta tarefa é ainda mais fácil](https://blog.caelum.com.br/2006/08/17/criando-um-webservice-com-a-jsr-181/), até mesmo para fazer o deploy do serviço.

**Não enviar XML dentro de XML** - outra prática comumente encontrada em aplicações antigas que usam Webservices: dentro do SOAP é enviado um outro XML como um dos parâmetros, então mesmo usando ferramentas para gerar os stubs você fica com uma `String` que dentro dela há um XML e este precisa ser parseado por sua própria aplicação. Isto é uma má interpretação do conceito que "_Webservices é comunicação via XML_". Concordo que em alguns raros casos isso possa fazer sentido, como por exemplo se o valor do que você quer realmente é um outro XML, mas no geral isto é feito sem necessidade nenhuma, como é o famoso caso do [WebService MS Office dos Correios do Brasil](http://www.correios.com.br/parcerias/cep/office2003/).

**Considerar protocolo binário** - são muitas as reclamações de que o SOAP acaba sendo um XML grande e pesado para ser transportado. Hoje em dia há muitas formas de contornar isso, como o uso do padrão [Fast InfoSet](http://java.sun.com/developer/technicalArticles/xml/fastinfoset/) para compressão do XML. Uma outra forma seria o uso de protocolos proprietários, como o [AMF](http://www.google.com/url?sa=t&ct=res&cd=3&url=http%3A%2F%2Fdownload.macromedia.com%2Fpub%2Flabs%2Famf%2Famf3_spec_121207.pdf&ei=yz-2R4r1LKXaefWTuPAM&usg=AFQjCNEpZD9SPSQD-pukeDrZduoOFTuhow&sig2=ikzhe6DLaBpXOBmP4ggL6A) da Adobe, que é uma opção comum no uso do Flex.

**Considerar não usar WSDL/SOAP** - pelas diversas críticas a burocracia exagerada do WSDL/SOAP, muitas pessoas estão optando por usar algo mais simples, como o bom e velho XML (POX), JSON ou até mesmo uma forma qualquer de estruturar dados. Caso você precise de simplicidade e velocidade no desenvolvimento com outras plataformas, essa é uma boa opção. **Cuidado**: muita gente está considerando qualquer webservice que não use WSDL/SOAP como sendo REST. Os [webservices do flickr](http://www.flickr.com/services/api/) e da [Amazon](http://aws.amazon.com/) são um bom exemplo: tudo é via GET (as vezes POST) e não há recurso identificado pela URI. Na verdade ele usa apenas um esquema HTTP+XML (POX), [considerado apenas em parte como RESTful](http://www.25hoursaday.com/weblog/PermaLink.aspx?guid=7a2f3df2-83f7-471b-bbe6-2d8462060263/). Você pode ver que esses webservices são muito diferentes do modelo RESTful do [Atom Publishing Protocol](http://tools.ietf.org/html/rfc5023). [Criar um protocolo realmente REST como este](http://www.xml.com/pub/a/2004/12/01/restful-web.html) não é fácil: porém teremos esse trabalho bastante simplificado com a [JAX-RS (JSR 311)](http://jcp.org/en/jsr/detail?id=311 ), e já podemos ver isso através do [Glassfish Jersey](https://jersey.dev.java.net/).

**Considerar usar JSON** - [JSON](http://www.json.org/) é um formato que tem ganho muita popularidade. Não é a toa: além de ser um simples para debugar, parsear e gerar, com javascript basta fazer um `eval` em um resultado JSON que ele já estará pronto para usar. É uma excelente opção para o consumo via AJAX e criação de mashups. JSON tem ganho bastante força na comunidade Flex, tornando-o uma ótima opção como ponte entre Flex e Java. A escolha por JSON abre portas para muitos tipos diferentes de clientes, e em especial o browser, que é nossa plataforma global.

_Update_: numa abordagem mais REST, a granularidade pode ser sim fina (e focada nos dados), tomando cuidado para deixar isso explícito, e sempre atento aos headers que possibilitarão o cache.
